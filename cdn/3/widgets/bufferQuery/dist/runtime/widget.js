System.register(["jimu-core","jimu-ui","jimu-arcgis","jimu-ui/advanced/map","esri/widgets/Sketch/SketchViewModel","esri/layers/GraphicsLayer","esri/rest/geoprocessor"],(function(e,t){var i={},a={},o={},s={},r={},n={},l={};return{setters:[function(e){i.React=e.React,i.WidgetState=e.WidgetState,i.css=e.css,i.jsx=e.jsx},function(e){a.Button=e.Button,a.Icon=e.Icon,a.Label=e.Label,a.Loading=e.Loading,a.Radio=e.Radio},function(e){o.JimuMapViewComponent=e.JimuMapViewComponent},function(e){s.JimuSymbolType=e.JimuSymbolType},function(e){r.default=e.default},function(e){n.default=e.default},function(e){l.default=e.default}],execute:function(){e((()=>{var e={322:e=>{e.exports="data:image/svg+xml;base64,PCEtLSBHZW5lcmF0ZWQgYnkgSWNvTW9vbi5pbyAtLT4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiB2aWV3Qm94PSIwIDAgMzIgMzIiPgo8dGl0bGU+Y2lyY2xlPC90aXRsZT4KPHBhdGggZD0iTTMyIDE2YzAgOC44MzctNy4xNjMgMTYtMTYgMTZzLTE2LTcuMTYzLTE2LTE2IDcuMTYzLTE2IDE2LTE2IDE2IDcuMTYzIDE2IDE2eiI+PC9wYXRoPgo8L3N2Zz4K"},474:e=>{e.exports="data:image/svg+xml;base64,PCEtLSBHZW5lcmF0ZWQgYnkgSWNvTW9vbi5pbyAtLT4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjM4IiBoZWlnaHQ9IjMyIiB2aWV3Qm94PSIwIDAgMzggMzIiPgo8dGl0bGU+aXJyZWd1bGFyPC90aXRsZT4KPHBhdGggZD0iTTYuMjMgNi4xOTNjLTMuMjM1IDMuMyAzLjcwNCA0Ljg1OSAxLjg4OCA5LjU1OHMtMTEuNjY5IDcuODY2LTYuNzYxIDEzLjUyMSA4LjM4NC0zLjE0NiAxNC42MTMtMi4xMjkgNS4xNjUgNi42MDYgMTEuMTI1IDQuMzA2YzUuOTYtMi4zLTIuNTU0LTEwLjI5NiAxLjA3MC0xMy4wNDZzMTEuMDIxLTUuMDIxIDkuMTk5LTguNzVjLTEuODIyLTMuNzI5LTQuNC0xLjUxMy04LjY2NS0xLjA4M3MtMC4zMjMtOC41Ny00LjU5Mi04LjU3LTMuNjczIDIuNzIzLTcuMjU2IDYuNjYxLTcuMzg1LTMuNzY4LTEwLjYxOS0wLjQ2OHoiPjwvcGF0aD4KPC9zdmc+Cg=="},456:e=>{e.exports="data:image/svg+xml;base64,PCEtLSBHZW5lcmF0ZWQgYnkgSWNvTW9vbi5pbyAtLT4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjM2IiBoZWlnaHQ9IjMyIiB2aWV3Qm94PSIwIDAgMzYgMzIiPgo8dGl0bGU+cG9seWdvbjwvdGl0bGU+CjxwYXRoIGQ9Ik0wIDEzLjcxNnYxNy45NDJoMzEuNzIzdi03LjIxOWwtMTAuMTg4LTEwLjE4OCAxNC4yNS0xNC4yNWgtMjMuNzg1eiI+PC9wYXRoPgo8L3N2Zz4K"},77:e=>{e.exports="data:image/svg+xml;base64,PCEtLSBHZW5lcmF0ZWQgYnkgSWNvTW9vbi5pbyAtLT4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiB2aWV3Qm94PSIwIDAgMzIgMzIiPgo8dGl0bGU+cmVjdGFuZ2xlPC90aXRsZT4KPHBhdGggZD0iTTEuNiA2LjRoMjguODg5djE4Ljc1NmgtMjguODg5di0xOC43NTZ6Ij48L3BhdGg+Cjwvc3ZnPgo="},231:e=>{"use strict";e.exports=n},650:e=>{"use strict";e.exports=l},878:e=>{"use strict";e.exports=r},826:e=>{"use strict";e.exports=o},891:e=>{"use strict";e.exports=i},726:e=>{"use strict";e.exports=a},290:e=>{"use strict";e.exports=s}},t={};function c(i){var a=t[i];if(void 0!==a)return a.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,c),o.exports}c.d=(e,t)=>{for(var i in t)c.o(t,i)&&!c.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="";var d={};return c.p=window.jimuConfig.baseUrl,(()=>{"use strict";c.r(d),c.d(d,{__set_webpack_public_path__:()=>w,default:()=>y});var e,t=c(891);!function(e){e.SINGLE="single",e.CONTINUOUS="continuous",e.UPDATE="update"}(e||(e={}));var i=c(726),a=c(826);const o={_widgetLabel:"Draw",drawPoint:"Draw point",drawLine:"Draw polyline",drawFreeLine:"Draw freehand polyline",drawRectangle:"Draw rectangle",drawPolygon:"Draw polygon",drawFreePolygon:"Draw freehand polygon",drawUndo:"Undo",drawRedo:"Redo",drawClear:"Clear all graphics",drawClearSelected:"Clear selected graphic",drawCircle:"Draw circle",drawText:"Draw text",preview:"Preview",fontColor:"Font color",fontSize:"Font size",fontHaloSize:"Font halo size",fontHaloColor:"Font halo color",enableFontHalo:"Enable font halo",fontHalo:"Font halo",fontRotation:"Font angle",fontVAbase:"Font vertical align baseline",fontVAtop:"Font vertical align top",fontVAbottom:"Font vertical align bottom",fontVAmid:"Font vertical align middle",fontBold:"Bold",fontItalic:"Italic",fontUnderline:"Underline",fontHAleft:"Font horizontal align left",fontHAcenter:"Font horizontal align center",fontHAright:"Font horizontal align right"};var s=c(290),r=c(878),n=c(231),l=c(650);const h=c(77),g=c(456),u=c(474),p=c(322);class y extends t.React.PureComponent{constructor(i){super(i),this.textPreviewSpan=t.React.createRef(),this.drawLayer=null,this.Graphic=null,this.nls=e=>this.props.intl?this.props.intl.formatMessage({id:e,defaultMessage:o[e]}):e,this.activeViewChangeHandler=t=>{null!=t?(this.setState({currentJimuMapView:t}),t.whenJimuMapViewLoaded().then((()=>{const{map:i}=t.view;if(this.state.widgetInit){this.creationMode=this.props.config.creationMode||e.SINGLE;const t=i.findLayerById("DrawGL");t?(this.drawLayer=t,this.drawLayer.graphics.length>0&&this.setState({drawGLLengthcheck:!0})):i.add(this.drawLayer)}this.drawLayer.graphics.watch("length",(e=>{e>0?this.setState({drawGLLengthcheck:!0}):this.setState({drawGLLengthcheck:!1})})),this.sketchViewModel=new r.default({view:t.view,updateOnGraphicClick:!0,layer:this.drawLayer}),this.sketchViewModel.on("create",this.svmGraCreate),this.sketchViewModel.on("update",this.svmGraUpdate)}))):this.setState({currentJimuMapView:null})},this.svmGraCreate=e=>{if("complete"===e.state&&"continuous"===this.creationMode)switch(this.state.currentTool){case"extent":this.sketchViewModel.create("rectangle");break;case"polygon":this.sketchViewModel.create("polygon");break;case"freepolygon":this.sketchViewModel.create("polygon",{mode:"freehand"});break;case"circle":this.sketchViewModel.create("circle")}else if("complete"===e.state&&"single"===this.creationMode){this.state.lastGraphic&&this.drawLayer.removeMany([this.state.lastGraphic]);let t={lastGraphic:e.graphic};this.setState(t),this.setDrawToolBtnState(null)}},this.svmGraUpdate=e=>{"start"===e.state?e.graphics&&e.graphics.map((t=>{this.setState({currentSymbol:e.graphics[0].symbol,graphics:e.graphics,clearBtnTitle:this.nls("drawClearSelected")})})):"complete"===e.state&&this.setState({graphics:null,clearBtnTitle:this.nls("drawClear")})},this.drawClearBtnClick=()=>{if(this.state.graphics&&this.state.graphics.length)return this.drawLayer.removeMany(this.state.graphics),void this.sketchViewModel.cancel();this.drawLayer.removeAll(),this.sketchViewModel.cancel(),this.setState({showActivate:!1,disabledDownload:!0})},this.queryBtnClick=()=>{switch(console.log("El valor del radio seleccionado es : "+this.state.radioSelected),this.setState({showLoading:!0}),this.state.radioSelected){case"pdf":this.generatePDF();break;case"gdb":this.generateSHPGDB("File Geodatabase - GDB - .gdb");break;case"shp":this.generateSHPGDB("Shapefile - SHP - .shp")}},this.generatePDF=()=>{const e={polygon_input:{geometryType:"esriGeometryPolygon",features:[{geometry:this.state.lastGraphic.geometry}],sr:{wkid:102100}}};l.default.submitJob("https://sig.simur.gov.co/arcgis/rest/services/Infraestructura/sigenerarreporte/GPServer/Tool",e).then((e=>{const t={statusCallback:e=>{console.log(e.jobStatus)}};e.waitForJobCompletion(t).then((t=>{e.fetchResultData("output_filename").then((e=>{let t={showLoading:!1,disabledDownload:!1,resultURL:e.value};this.setState(t)}))}))})).catch((e=>{console.log(e),this.setState({showLoading:!1})}))},this.generateSHPGDB=e=>{const t={Layers_to_Clip:["EstudiosTransito_Linea","EstudiosTransito_Area","EstudiosTransito_Punto"],Area_of_Interest:{geometryType:"esriGeometryPolygon",features:[{geometry:this.state.lastGraphic.geometry}],sr:{wkid:102100}},Feature_Format:e,Raster_Format:"ESRI GRID - GRID"};l.default.submitJob("https://sig.simur.gov.co/arcgis/rest/services/DSVCT/DescargaDatos_SIMUR/GPServer/Extract%20Data%20Task",t).then((e=>{const t={statusCallback:e=>{console.log(e.jobStatus)}};e.waitForJobCompletion(t).then((t=>{e.fetchResultData("Output_Zip_File").then((e=>{let t={showLoading:!1,disabledDownload:!1,resultURL:e.value.url};this.setState(t)}))}))})).catch((e=>{console.log(e),this.setState({showLoading:!1})}))},this.downloadBtnClick=()=>{const e=this.state.resultURL,t=e.substring(e.lastIndexOf("/")+1);fetch(e).then((e=>{if(!e.ok)throw new Error("Error al descargar el archivo");return e.blob()})).then((e=>{const i=URL.createObjectURL(e),a=document.createElement("a");a.href=i,a.download=t,a.style.display="none",document.body.appendChild(a),a.click(),URL.revokeObjectURL(i),document.body.removeChild(a)})).catch((e=>{console.error("Error de descarga:",e)}))},this.updateActiveBtnIcons=()=>{setTimeout((()=>{let e=document.querySelectorAll(".btn-group>.icon-btn");Array.from(e).forEach((e=>{this.setImgElemFilter(e,e.classList.contains("active"))}))}),20)},this.setImgElemFilter=(e,t)=>{let i=e.getElementsByTagName("img")[0];i&&(i.getAttribute("style")&&i.getAttribute("style").indexOf("filter:")>-1&&!t&&(i.style.filter=""),i.getAttribute("style")&&""!=i.style.filter||!t||(i.style.filter="invert(1)"))},this.setDrawToolBtnState=e=>{let t={rectBtnActive:!1,polygonBtnActive:!1,fpolygonBtnActive:!1,circleBtnActive:!1,currentTool:e,showActivate:!1};switch(e){case"extent":t.currentSymbol=this.sketchViewModel.polygonSymbol,t.currentSymbolType=s.JimuSymbolType.Polygon,this.state.rectBtnActive?this.sketchViewModel.cancel():(this.sketchViewModel.create("rectangle"),t.rectBtnActive=!0);break;case"polygon":t.currentSymbol=this.sketchViewModel.polygonSymbol,t.currentSymbolType=s.JimuSymbolType.Polygon,this.state.polygonBtnActive?this.sketchViewModel.cancel():(this.sketchViewModel.create("polygon"),t.polygonBtnActive=!0);break;case"freepolygon":t.currentSymbol=this.sketchViewModel.polygonSymbol,t.currentSymbolType=s.JimuSymbolType.Polygon,this.state.fpolygonBtnActive?this.sketchViewModel.cancel():(this.sketchViewModel.create("polygon",{mode:"freehand"}),t.fpolygonBtnActive=!0);break;case"circle":t.currentSymbol=this.sketchViewModel.polygonSymbol,t.currentSymbolType=s.JimuSymbolType.Polygon,this.state.circleBtnActive?this.sketchViewModel.cancel():(t.circleBtnActive=!0,this.sketchViewModel.create("circle"));break;default:this.sketchViewModel.cancel()}t.showActivate=null==e,this.setState(t)},this.handleClickRadio=e=>{this.setState({radioSelected:e.target.id}),this.setState({disabledDownload:!0})},this.state={currentJimuMapView:null,graphics:[],rectBtnActive:!1,polygonBtnActive:!1,fpolygonBtnActive:!1,circleBtnActive:!1,currentSymbol:null,currentSymbolType:null,clearBtnActive:!1,drawGLLengthcheck:!1,currentTool:"",clearBtnTitle:this.nls("drawClear"),widgetInit:!1,showActivate:!1,lastGraphic:null,radioSelected:"shp",showLoading:!1,disabledDownload:!0,resultURL:null},this.creationMode=this.props.config.creationMode||e.SINGLE}componentDidMount(){this.setState({widgetInit:!0}),this.drawLayer=new n.default({id:"DrawGL",listMode:"hide"})}componentDidUpdate(){if(this.state.currentJimuMapView){const{view:e}=this.state.currentJimuMapView;let i=this.props.state;i===t.WidgetState.Closed&&this.sketchViewModel?this.sketchViewModel.updateOnGraphicClick=!1:i===t.WidgetState.Opened&&this.sketchViewModel&&(this.sketchViewModel.updateOnGraphicClick=!0)}}componentWillUnmount(){this.drawLayer&&(this.drawLayer.removeAll,this.drawLayer=null)}render(){var e;const{config:o}=this.props,{drawGLLengthcheck:s,rectBtnActive:r,polygonBtnActive:n,fpolygonBtnActive:l,circleBtnActive:c,showActivate:d,showLoading:y,disabledDownload:w}=this.state;return(0,t.jsx)("div",{className:"widget-draw jimu-widget",css:(m=this.props.theme,m.surfaces[1].bg,t.css`
  .drawToolbarDiv {
    margin: 8px;
    text-align: center;
  }

  .drawToolbarBottomDiv {
    display: flex;
    justify-content: center;
    padding-top: 12px;
  }

  .drawToolbarDiv button,
  .drawToolbarBottomDiv button {
    margin: 4px;
  }

  .drawToolbarDiv>button>Img.jimu-icon,
  .drawToolbarBottomDiv>button>Img.jimu-icon {
    margin: 0;
  }

  .jimu-btn.btn.btn-default.btn-sm.active img,
  .jimu-btn.btn.btn-primary.btn-sm img {
    filter: invert(1);
  }
  .jimu-draw-symbol-divide-line {
    border-right: 1px solid rgb(182, 182, 182);
    height: 26px;
  }
  .color-presenter {
    inset: 2px;
  }
  .myss {
    width: 40px;
    margin: auto;
  }
  .symbol-wapper.outer-preview-btn {
    height: 26px;
    width: 26px;
  }
  .radiolabel-container {
    display: flex;
    gap: 5px;
    margin-top: 5px;
  }
  `)},this.props.useMapWidgetIds&&1===this.props.useMapWidgetIds.length&&(0,t.jsx)(a.JimuMapViewComponent,{useMapWidgetId:null===(e=this.props.useMapWidgetIds)||void 0===e?void 0:e[0],onActiveViewChange:this.activeViewChangeHandler}),y&&(0,t.jsx)(i.Loading,{type:"PRIMARY"}),(0,t.jsx)("div",{className:"drawToolbarDiv"},(0,t.jsx)(i.Button,{size:"sm",type:"default",active:r,onClick:()=>{this.setDrawToolBtnState("extent")},title:this.nls("drawRectangle")}," ",(0,t.jsx)(i.Icon,{icon:h})),(0,t.jsx)(i.Button,{size:"sm",type:"default",active:n,onClick:()=>{this.setDrawToolBtnState("polygon")},title:this.nls("drawPolygon")}," ",(0,t.jsx)(i.Icon,{icon:g})),(0,t.jsx)(i.Button,{size:"sm",type:"default",active:l,onClick:()=>{this.setDrawToolBtnState("freepolygon")},title:this.nls("drawFreePolygon")}," ",(0,t.jsx)(i.Icon,{icon:u})),(0,t.jsx)(i.Button,{size:"sm",type:"default",active:c,onClick:()=>{this.setDrawToolBtnState("circle")},title:this.nls("drawCircle")}," ",(0,t.jsx)(i.Icon,{icon:p}))),d&&(0,t.jsx)("div",{style:{paddingLeft:"20px"}},(0,t.jsx)("div",null,(0,t.jsx)("p",null,"Exportar:"),(0,t.jsx)("div",{className:"radiolabel-container"},(0,t.jsx)(i.Radio,{name:"file_type",id:"shp",value:"SHP",onChange:this.handleClickRadio,checked:"shp"===this.state.radioSelected}),(0,t.jsx)(i.Label,null,"Shapefile")),(0,t.jsx)("div",{className:"radiolabel-container"},(0,t.jsx)(i.Radio,{name:"file_type",id:"gdb",value:"GDB",onChange:this.handleClickRadio,checked:"gdb"===this.state.radioSelected}),(0,t.jsx)(i.Label,null,"File Geodatabase")),(0,t.jsx)("div",{className:"radiolabel-container"},(0,t.jsx)(i.Radio,{name:"file_type",id:"pdf",value:"PDF",onChange:this.handleClickRadio,checked:"pdf"===this.state.radioSelected}),(0,t.jsx)(i.Label,null,"PDF")))),d&&(0,t.jsx)("div",{className:"drawToolbarBottomDiv"},(0,t.jsx)(i.Button,{size:"default",type:"primary",onClick:this.queryBtnClick},"Consultar"),(0,t.jsx)(i.Button,{size:"sm",type:"secondary",onClick:this.drawClearBtnClick,disabled:!s},"Limpiar"),(0,t.jsx)(i.Button,{size:"sm",type:"secondary",onClick:this.downloadBtnClick,disabled:w},"Descargar")));var m}}function w(e){c.p=e}})(),d})())}}}));